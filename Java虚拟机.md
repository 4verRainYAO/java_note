# Java虚拟机

## 1.什么是java虚拟机？

java虚拟机就是将java源文件编译成可执行的字节码文件，屏蔽了不同操作系统的底层硬件的指令，这样就实现了java跨平台的特性。

## 2.内存模型

### （1）程序计数器：

每个线程私有，存放当前正在执行指令的地址。

### （2）本地方法栈：

每个线程私有，跟java栈一样，不过是为本地方法服务。本地方法就是native方法，用c语言写的。

### （3）java栈：

每个线程私有，里面是一个个的栈帧，每个方法对应一个栈帧，每个栈帧里面存放局部变量表，操作数栈，动态链接，方法出口等信息。生命周期跟线程一致。

### （4）方法区

线程共享，存放JVM加载出来的类信息，常量，静态变量，即时编译器编译出来的代码等。jdk1.8之前字符串常量池还在方法区中，1.8之后就从方法区移动到堆中了。

### （5）堆

线程共享，存放对象。分为新生代，和年老代。内存比例是1：2

新生代分为Eden， From Survivor和To Survivor区域。内存比例是8：1：1。刚new出来的对象都一般都放在Eden区域，年龄为1岁。**Eden区域满了，发生Minor GC**，采用复制算法，将Eden区域和Survivor区域存活的对象向另一个Survivor区域复制，然后进行清除，活下来的对象年龄+1，达到15岁时对象被送入年老代。

年老代，一般存放大对象和长期存活的对象。**满了之后发生Full GC**，两种算法：

1. 标记-清除：缺点，产生内存碎片，标记和清除效率都很低
2. 标记-整理：标记后将所有存活的对象统一移动向一端，然后对边界之外的对象进行回收。

#### 对象进入年老带的条件：

1. 大对象
2. 对象年龄超过15岁，经历14次GC
3. Survivor空间放不下了

## 3.垃圾收集器

### （1）Serial收集器

针对新生代

采用复制算法

单线程收集：进行垃圾回收时，必须暂停所有工作线程，直到回收完成。

### （2）ParNew收集器

Serial的多线程版本

### （3）Parallel Scavenge收集器（吞吐量收集器）

针对新生代

采用复制算法

多线程收集

特点：目标是达一个可控制的吞吐量，与其他回收器的侧重点不同

### （4）Serial Old

针对老年代

采用标记-整理算法

单线程收集

### （5）Parallel Old收集器

针对老年代

采用标记-整理算法

多线程收集

### （6）CMS收集器

针对老年代

采用标记-清除算法

以最短回收停顿时间为目标

并发收集

### （7）G1收集器

针对新生代和年老代

垃圾回收与程序运行可以同事进行，并发。

多种垃圾算法组合，空间整合，不产生碎片

低停顿同时实现高吞吐量





